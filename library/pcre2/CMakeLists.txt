cmake_minimum_required(VERSION 3.1)

project("pcre2" C)

set(PCRE2_VER pcre2-10.31)

set(PCRE2_SRC_DIR
    ${CMAKE_CURRENT_SOURCE_DIR}/${PCRE2_VER}/src
    CACHE INTERNAL "PCRE2_SRC_DIR")
set(PCRE2_BIN_DIR
    ${CMAKE_CURRENT_BINARY_DIR}/${PCRE2_VER}
    CACHE INTERNAL "PCRE2_BIN_DIR")
set(PCRE2_INC_DIR
    ${PCRE2_BIN_DIR}/include
    CACHE INTERNAL "PCRE2_INC_DIR")

set(PCRE2_BUILD_PCRE2_8       ON  CACHE BOOL "" FORCE)
set(PCRE2_BUILD_PCRE2_16      OFF CACHE BOOL "" FORCE)
set(PCRE2_BUILD_PCRE2_32      OFF CACHE BOOL "" FORCE)
set(PCRE2_DEBUG               OFF CACHE BOOL "" FORCE)
set(PCRE2_SHOW_REPORT         OFF CACHE BOOL "" FORCE)
set(PCRE2_BUILD_PCRE2GREP     OFF CACHE BOOL "" FORCE)
set(PCRE2_BUILD_TESTS         OFF CACHE BOOL "" FORCE)
set(NON_STANDARD_LIB_PREFIX   OFF CACHE BOOL "" FORCE)
set(NON_STANDARD_LIB_SUFFIX   OFF CACHE BOOL "" FORCE)
set(PCRE2_STATIC_RUNTIME      OFF CACHE BOOL "" FORCE)
set(INSTALL_MSVC_PDB          OFF CACHE BOOL "" FORCE)
set(PCRE2_SUPPORT_LIBBZ2      OFF CACHE BOOL "" FORCE)
set(PCRE2_SUPPORT_LIBZ        OFF CACHE BOOL "" FORCE)
set(PCRE2_SUPPORT_LIBEDIT     OFF CACHE BOOL "" FORCE)
set(PCRE2_SUPPORT_LIBREADLINE OFF CACHE BOOL "" FORCE)
set(PCRE2_REBUILD_CHARTABLES  OFF CACHE BOOL "" FORCE)

if(USE_JIT)
    set(PCRE2_SUPPORT_JIT ON  CACHE BOOL "" FORCE)
else()
    set(PCRE2_SUPPORT_JIT OFF CACHE BOOL "" FORCE)
endif()

add_subdirectory(${CMAKE_CURRENT_SOURCE_DIR}/${PCRE2_VER})

configure_file(
    ${PCRE2_BIN_DIR}/pcre2.h
    ${PCRE2_BIN_DIR}/include/pcre2.h
    COPYONLY)

add_subdirectory(tests)
